@model CECRunningChart.Web.Models.Runningchart.RunningchartModel
@{
    ViewBag.Title = "New Running Chart";
}

<style type="text/css">
    table tr td input[type="text"]
    {
        width: 110px;
    }
    table tr .selectDesign select
    {
        width: 150px;
        margin:0px;
    }
   .mainContent
    {
        width:1309px;
    }
</style>
<link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.timepicker.css")" type="text/css" />
<script src="@Url.Content("~/Scripts/ui/jquery.ui.core.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/ui/jquery.ui.widget.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/ui/jquery.ui.datepicker.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/ui/jquery.ui.timepicker.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/runningchart.js")" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $("#BillDate").datepicker({
            changeMonth: true,
            changeYear: true
        });

        setTimePickers();
        applyRunningchartValidations();

        $("#SelectedVehicleId").change(function () {
            var selectedVehicle = $("#SelectedVehicleId").val();
            var isVehicle = $("#IsVehicle" + selectedVehicle).val();
            if (isVehicle) {
                applyTimePickersToMeter();
            }
        });

        $("#runningchartform").submit(function () {
            var isValid = $("#runningchartform").valid();
            var isLubValid = isLubricantsValid();
            var isPumpValid = isPumpstationsValid();
            var isItemsValid = isChartDetailsValid();

            return isValid || isLubValid || isPumpValid || isItemsValid;
        });

        $("#FuelLeftEndOfDay").keyup(function () {
            var fuelLeftBOD = $.trim($("#FuelLeftBegningOfDay").val());
            var fuelLeftEOD = $.trim($(this).val());
            if (fuelLeftBOD == "" || fuelLeftEOD == "") {
                return;
            }

            var pumpstationCount = $("#PumpstationsCount").val();
            var pumpQty = 0;
            for (var i = 0; i < pumpstationCount; i++) {
                var qty = parseFloat(document.getElementById("SelectedPumpstations[" + i + "].PumpAmount").value);
                pumpQty += qty;
            }

            var fuelUsage = (parseFloat(fuelLeftBOD) + pumpQty) - parseFloat(fuelLeftEOD);
            $("#FuelUsageOfDay").val(fuelUsage);
        });
    });
</script>

@using (Html.BeginForm("create", "runningchart", FormMethod.Post, new { @id = "runningchartform"}))
{
    <h2>New Running Chart</h2>
    <div id="BasicInfo">
        <table>
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>Bill Number</td>
                <td><input type="text" id="BillNumber" name="BillNumber" maxlength="10" /></td>
            </tr>
            <tr>
                <td>Date</td>
                <td><input type="text" id="BillDate" name="BillDate" value="@Model.BillDate.ToString("d")" /></td>
                <td>Driver Name</td>
                <td><input type="text" id="DriverName" name="DriverName" maxlength="200" /></td>
            </tr>
            <tr>
                <td>Vehicle #</td>
                <td>
                    @Html.DropDownList("SelectedVehicleId", Model.GetVehicleOptions(), new { @id = "SelectedVehicleId" })
                    @foreach (var vehicle in Model.Vehicles)
                    {
                        <input type="hidden" id="@string.Concat("IsVehicle", vehicle.Id.ToString())" value="@vehicle.IsVehicle" />
                    }
                </td>
                <td>Fuel Left Begning of the Day</td>
                <td><input type="text" id="FuelLeftBegningOfDay" name="FuelLeftBegningOfDay" /> L</td>
            </tr>
            <tr>
                <td>Day Start Time</td>
                <td><input type="text" id="DayStartime" name="DayStartime" class="timepick" value="" /></td>
                <td>Day End Time</td>
                <td><input type="text" id="DayEndTime" name="DayEndTime" class="timepick" value="" /></td>
            </tr>
        </table>
    </div>
    <br />
    <div id="PumpStationInfo">
        @Html.Partial("_Pumpstations", Model)
    </div>
    <br />
    <div id="LubricantInfo">
        @Html.Partial("_Lubricants", Model)
    </div>
    <br />
    <div id="ChartItems">
        @Html.Partial("_ChartItems", Model)
    </div>
    <br />
    <div id="Statistics">
        <table>
            <tr>
                <td>Fuel Left End of the Day</td>
                <td>Fuel Usage of the Day</td>
            </tr>
            <tr>
                <td><input type="text" id="FuelLeftEndOfDay" name="FuelLeftEndOfDay" /></td>
                <td><input type="text" id="FuelUsageOfDay" name="FuelUsageOfDay" readonly="readonly" /></td>
            </tr>
        </table>
        <table>
            <tr>
                <td>Daily Note</td>
            </tr>
            <tr>
                <td><textarea rows="5" cols="27" id="DailyNote" name="DailyNote"></textarea></td>
            </tr>
        </table>
    </div>
    <br />
    <div id="Authorization">
        <input type="submit" value="Send to Approve" />
    </div>
}