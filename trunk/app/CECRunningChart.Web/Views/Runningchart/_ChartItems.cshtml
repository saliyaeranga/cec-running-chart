@model CECRunningChart.Web.Models.Runningchart.RunningchartModel

<script type="text/javascript">
    function PopulateChartRows(isAdding, isRemoving, removingId) {
        var selectedVehicle = $("#SelectedVehicleId").val();
        if (parseInt(selectedVehicle) <= 0) {
            alert("Please Select the Vehicle First!");
            return;
        }

        var formParameters = new Object();
        formParameters.isAddingNewItem = isAdding;
        formParameters.isVehicle = $("#IsVehicle" + selectedVehicle).val();

        var itemCount = $("#ChartItemsCount").val();
        for (var index = 0; index < itemCount; index++) {
            formParameters["[" + index + "].StartTime"] = document.getElementById("SelectedChartItems[" + index + "].StartTime").value;
            formParameters["[" + index + "].EndTime"] = document.getElementById("SelectedChartItems[" + index + "].EndTime").value;
            formParameters["[" + index + "].TimeDifference"] = document.getElementById("SelectedChartItems[" + index + "].TimeDifference").value;
            formParameters["[" + index + "].StartMeter"] = document.getElementById("SelectedChartItems["+ index+ "].StartMeter").value;
            formParameters["[" + index + "].EndMeter"] = document.getElementById("SelectedChartItems[" + index + "].EndMeter").value;
            formParameters["[" + index + "].MeterDifference"] = document.getElementById("SelectedChartItems[" + index + "].MeterDifference").value;

            var pumpAmount = document.getElementById("SelectedChartItems[" + index + "].IdleHours").value;
            formParameters["[" + index + "].IdleHours"] = pumpAmount == "" ? "0" : pumpAmount;

            formParameters["[" + index + "].SelectedProjectId"] = document.getElementById("SelectedChartItems["+ index+ "].SelectedProjectId").value;
            formParameters["[" + index + "].SelectedProjectManager"] = document.getElementById("SelectedChartItems[" + index + "].SelectedProjectManager").value;
            formParameters["[" + index + "].SelectedRentalTypeId"] = document.getElementById("SelectedChartItems[" + index + "].SelectedRentalTypeId").value;

            // Is removing this item
            if (isRemoving == true && index == removingId) {
                formParameters["[" + index + "].IsRemoving"] = true;
            }
        }

        $.ajaxSetup({ cache: false });
        $.post('@Url.Action("PoulateChartItems", "Runningchart")', formParameters, function (data) {
            document.getElementById("ChartItems").innerHTML = data;
            setTimePickers();
        });
    }

    function calculateTimeDiff() {

    }
</script>
@{ 
    int itemCount = 0;
    string meterText = Model.isVehicle ? "Meter" : "Hour";
}
<table>
    <tr>
        <td>Start Time</td>
        <td>End Time</td>
        <td>Time Difference</td>
        <td>Start @meterText</td>
        <td>End @meterText</td>
        <td>@meterText Difference</td>
        <td>Idle Hours</td>
        <td>Project Name</td>
        <td>Project Manager</td>
        <td>Rental Type</td>
        <td>&nbsp;</td>
    </tr>
    @if (Model.SelectedChartItems != null && Model.SelectedChartItems.Count > 0)
    {
        itemCount = Model.SelectedChartItems.Count;
        int index = 0;
        
        foreach (var item in Model.SelectedChartItems)
        {
            string startTimeId = string.Concat("SelectedChartItems[", index, "].StartTime");
            string endTimeId = string.Concat("SelectedChartItems[", index, "].EndTime");
            string timeDiffId = string.Concat("SelectedChartItems[", index, "].TimeDifference");
            string startMeterId = string.Concat("SelectedChartItems[", index, "].StartMeter");
            string endMeterId = string.Concat("SelectedChartItems[", index, "].EndMeter");
            string meterDiffId = string.Concat("SelectedChartItems[", index, "].MeterDifference");
            string idleHoursId = string.Concat("SelectedChartItems[", index, "].IdleHours");
            string selectedProjectId = string.Concat("SelectedChartItems[", index, "].SelectedProjectId");
            string selectedRentalTypeId = string.Concat("SelectedChartItems[", index, "].SelectedRentalTypeId");
            string selectedProjectManagerId = string.Concat("SelectedChartItems[", index, "].SelectedProjectManager");
            string idleHourText = item.IdleHours == 0 ? string.Empty : item.IdleHours.ToString();
            <tr>
                <td><input type="text" id="@startTimeId" name="@startTimeId" value="@item.StartTime" maxlength="10" class="timepick" /></td>
                <td><input type="text" id="@endTimeId" name="@endTimeId" value="@item.EndTime" maxlength="10" class="timepick" onblur="calculateTimeDiff();" /></td>
                <td><input type="text" id="@timeDiffId" name="@timeDiffId" value="@item.TimeDifference" maxlength="10" /></td>
                <td><input type="text" id="@startMeterId" name="@startMeterId" value="@item.StartMeter" maxlength="10" /></td>
                <td><input type="text" id="@endMeterId" name="@endMeterId" value="@item.EndMeter" maxlength="10" /></td>
                <td><input type="text" id="@meterDiffId" name="@meterDiffId" value="@item.MeterDifference" maxlength="10" /></td>
                <td><input type="text" id="@idleHoursId" name="@idleHoursId" value="@idleHourText" maxlength="10" /></td>
                <td>
                    @Html.DropDownList(selectedProjectId, Model.GetProjectOptions(item.SelectedProjectId), new { @id = selectedProjectId, @class = "todo" })
                </td>
                <td><input type="text" id="@selectedProjectManagerId" name="@selectedProjectManagerId" value="@item.SelectedProjectManager" maxlength="200" /></td>
                <td>
                    @Html.DropDownList(selectedRentalTypeId, Model.GetRentalTypeOptions(item.SelectedRentalTypeId), new { @id = selectedRentalTypeId, @class = "todo" })
                </td>
                <td><input type="button" value="Remove" onclick="PopulateChartRows(false, true, @index);" /></td>
            </tr>
            index++;
        }
    }
    <tr>
        <td><input type="button" value="Add" onclick="PopulateChartRows(true, false, 0);" /></td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
    </tr>
</table>
<input type="hidden" id="ChartItemsCount" value="@itemCount" />