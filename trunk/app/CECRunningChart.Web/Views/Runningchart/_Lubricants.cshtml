@model CECRunningChart.Web.Models.Runningchart.RunningchartModel
           
<script type="text/javascript">
    function PopulateLubricantstationRows(isAdding, isRemoving, removingId) {
        var formParameters = new Object();
        formParameters.isAddingNewItem = isAdding;

        var itemCount = document.getElementById("LubricantstationsCount").value;
        for (var i = 0; i < itemCount; i++) {
            formParameters["[" + i + "].SelectedPumpstationId"] = document.getElementById("SelectedLubricants[" + i + "].SelectedPumpstationId").value;
            formParameters["[" + i + "].SelectedLubricantTypeId"] = document.getElementById("SelectedLubricants[" + i + "].SelectedLubricantTypeId").value;
            var pumpAmount = document.getElementById("SelectedLubricants[" + i + "].PumpAmount").value;
            formParameters["[" + i + "].PumpAmount"] = pumpAmount != "" ? pumpAmount : "0";

            // Is removing this item
            if (isRemoving == true && i == removingId) {
                formParameters["[" + i + "].IsRemoving"] = true;
            }
        }

        $.ajaxSetup({ cache: false });
        $.post('@Url.Action("PoulateLubricantItems", "Runningchart")', formParameters, function (data) {
            document.getElementById("LubricantInfo").innerHTML = data;
        });
    }
</script>
@{ int lubItemCount = 0; }
<table>
    <tr>
        <td>Pump Station</td>
        <td>Lubricant Type</td>
        <td>Pump Amount</td>
        <td>&nbsp;</td>
    </tr>
    @if (Model.SelectedLubricants != null && Model.SelectedLubricants.Count > 0)
    {
        lubItemCount = Model.SelectedLubricants.Count;
        int index = 0;
        foreach (var lubricant in Model.SelectedLubricants)
        {
            var pumpstationId = string.Concat("SelectedLubricants[", index, "].SelectedPumpstationId");
            var lubricantTypeId = string.Concat("SelectedLubricants[", index, "].SelectedLubricantTypeId");
            var amountId = string.Concat("SelectedLubricants[", index, "].PumpAmount");
            var amount = lubricant.PumpAmount == 0 ? string.Empty : lubricant.PumpAmount.ToString();
            <tr>
                <td>
                    @Html.DropDownList(pumpstationId, Model.GetPumpstationOptions(lubricant.SelectedPumpstationId), new { @id = pumpstationId, @class = "todo" })
                </td>
                <td>
                    @Html.DropDownList(lubricantTypeId, Model.GetLubricantOptions(lubricant.SelectedLubricantTypeId), new { @id = lubricantTypeId, @class = "todo" })
                </td>
                <td><input type="text" id="@amountId" name="@amountId" value="@amount" /></td>
                <td><input type="button" value="Remove" onclick="PopulateLubricantstationRows(false, true, @index);" /></td>
            </tr>
            index++;
        }
    }
    <tr>
        <td><input type="button" value="Add" onclick="PopulateLubricantstationRows(true, false, 0);" /></td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
    </tr>
</table>
<input type="hidden" id="LubricantstationsCount" value="@lubItemCount" />